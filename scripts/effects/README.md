# benchmarking

# 0. Perl Module

```
cpan -i Statistics::Basic
cpan -i List::Util
cpan -i Math::Complex
```

# 0. Symlink drift so it's available in `/usr`
```
export DRIFT_REPO=/tools/home/eric/drift
sudo ln -s $DRIFT_REPO/drift.exe /usr/local/bin
```
# 1. Building the python package

Note: This package includes toolinfo for both DRIFT and COARMOCHI

```
# AS ROOT!
export DRIFT_REPO=/tools/home/eric/drift
cd $DRIFT_REPO/scripts/benchexec-drifttoolinfo
sudo pip uninstall drifttoolinfo
sudo python3 setup.py sdist bdist_wheel
sudo pip install .
```

# 2. Testing the Drift tool-info Python module 

```
# As ROOT!
PATH=$PATH:/tools/home/eric/drift/ python3 -m benchexec.test_tool_info drifttoolinfo.drift --read-only-dir /
```

# 3. Running benchmarking

## 3.a Running Drift (including via translation and via our new analysis)
```
export DRIFT_REPO=/tools/home/eric/drift
cd $DRIFT_REPO/scripts/effects
perl makeYamls.pl
perl makeRunDefinitions.pl
sudo benchexec benchmark-drift-autogenerated.xml --read-only-dir / --limitCores 2 --timelimit 900s --numOfThreads 8
```

## 3.b Running COaR/RCaml

```
export DRIFT_REPO=/tools/home/eric/drift
cd $DRIFT_REPO/scripts/effects
sudo benchexec benchmark-coarmochi.xml --read-only-dir / --limitCores 2 --timelimit 900s --numOfThreads 8
```

## 3.c Running MoChi

```
export DRIFT_REPO=/tools/home/eric/drift
cd $DRIFT_REPO/tests/effects/tr_tuple_mochi
rm *.{json,status,annot,bin} *hors*
chmod 666 *; cd ..; chmod 777 tr_tuple_mochi
cd $DRIFT_REPO/scripts/effects
sudo benchexec benchmark-mochi.xml --read-only-dir / --limitCores 2 --timelimit 900s --numOfThreads 8
```

It will then tell you what `table-generator` command to run.

# 4. Generating LaTeX

Run `table-generator` as instructed by the output of `benchexec`. You will then have two CSV files with names like:

 * `results/benchmark-coarmochi.2024-02-25_10-16-09.results.default.mochibenchmarks.csv`
 * `results/results.2024-02-25_12-18-59.table.csv`

Edit `makeLatex.pl` and provide these as arguments to `parseResultsFile`

Run `perl makeLatex.pl`